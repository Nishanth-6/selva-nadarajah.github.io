---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeaderNav from "../components/HeaderNav.astro";
import Footer from "../components/Footer.astro";
import Section from "../components/Section.astro";
import Card from "../components/Card.astro";
import { getCollection, getEntry } from "astro:content";

const page = await getEntry("pages", "teaching");
if (!page) throw new Error("Missing content entry: pages/teaching.md");
const { Content } = await page.render();

const entries = await getCollection("teaching");
const data = entries[0]?.data as any;
const terms = data?.terms ?? [];
---

<BaseLayout title={`${page.data.title} - Selva Nadarajah`} description={page.data.description ?? ""}>
  <HeaderNav slot="header" />
  <h1>{page.data.title}</h1>

  <Section title="Overview">
    <Content />
  </Section>

  {terms.length === 0 ? (
    <p>No teaching data yet.</p>
  ) : (
    terms.map((t: any) => (
      <Section title={t.term}>
        <div class="grid">
          {t.items.map((c: any) => (
            <Card title={c.course}>
              {c.title ? <p>{c.title}</p> : null}
              {c.institution ? <p>{c.institution}</p> : null}
              {c.role ? <p>{c.role}</p> : null}
              {c.notes?.length ? (
                <ul>
                  {c.notes.map((n: string) => <li>{n}</li>)}
                </ul>
              ) : null}
              {c.url ? <p><a href={c.url}>Course link</a></p> : null}
            </Card>
          ))}
        </div>
      </Section>
    ))
  )}

  <Footer slot="footer" />
</BaseLayout>

<style>
.grid {
  display: grid;
  grid-template-columns: repeat(1, minmax(0, 1fr));
  gap: 1rem;
}
@media (min-width: 800px) {
  .grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}
</style>
