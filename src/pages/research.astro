---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeaderNav from "../components/HeaderNav.astro";
import Footer from "../components/Footer.astro";
import Section from "../components/Section.astro";
import PublicationList from "../components/PublicationList.astro";
import { getCollection, getEntry } from "astro:content";

const page = await getEntry("pages", "research");
if (!page) throw new Error("Missing content entry: pages/research.md");
const { Content } = await page.render();

const pubsEntries = await getCollection("publications");
const pubsData = pubsEntries.flatMap((e) => (e.data as any).items);
---

<BaseLayout title={`${page.data.title} - Selva Nadarajah`} description={page.data.description ?? ""}>
  <HeaderNav slot="header" />
  <h1>{page.data.title}</h1>

  <Section title="Overview">
    <Content />
  </Section>

  <Section title="Selected publications">
    <PublicationList items={pubsData} selectedOnly={true} />
  </Section>

  <Section title="All publications">
    <PublicationList items={pubsData} />
  </Section>

  <Footer slot="footer" />
</BaseLayout>
